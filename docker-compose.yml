version: "3.9"

services:
  copyparty:
    image: copyparty/ac:latest
    container_name: copyparty
    restart: unless-stopped
    networks:
      - setups-network
    command:
      - -c
      - /config/copyparty.conf
    volumes:
      - /opt/stacks/copyparty/config:/config
      - /opt/stacks/setup-downloader/setups:/srv/setups/mothervault:ro

  setup-downloader:
    image: ghcr.io/michelgerding/setup-downloader:latest
    container_name: setup-downloader
    restart: unless-stopped
    networks:
      - setups-network
    environment:
      - AUTH_URL=${AUTH_URL}
      - SIMDATA_URL=${SIMDATA_URL}
      - DATAPACKS_URL=${DATAPACKS_URL}
      - MEMBER_URL=${MEMBER_URL}
      - ADMIN_USERNAME=${ADMIN_USERNAME}
      - ADMIN_PASSWORD=${ADMIN_PASSWORD}
      - REFRESH_TOKEN=${REFRESH_TOKEN}
    volumes:
      - /opt/stacks/setup-downloader/setups:/app/setups

  caddy:
    image: caddy:latest
    container_name: caddy-proxy
    restart: unless-stopped
    networks:
      - setups-network
    ports:
      - "80:80"
      - "443:443"
    volumes:
      - /opt/stacks/caddy/Caddyfile:/etc/caddy/Caddyfile
      - /opt/stacks/caddy/data:/data
      - /opt/stacks/caddy/config:/config

networks:
  setups-network:
    driver: bridge